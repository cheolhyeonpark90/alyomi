<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product List - Category + Pagination</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background-color: #f9f9f9;
        }

        .controls {
            margin-bottom: 1rem;
        }

        .product {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .product img {
            width: 320px;
            height: 320px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .keywords {
            font-size: 0.95rem;
            color: #666;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            background-color: white;
            cursor: pointer;
            border-radius: 6px;
        }

        .pagination button.active {
            font-weight: bold;
            background-color: #333;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: default;
        }
    </style>
</head>

<body>
    <h1>ÏÉÅÌíà Î¶¨Ïä§Ìä∏</h1>
    <div class="controls">
        <label for="category-select">Ïπ¥ÌÖåÍ≥†Î¶¨:</label>
        <select id="category-select">
            <option value="all">Ï†ÑÏ≤¥ Î≥¥Í∏∞</option>
        </select>
    </div>

    <div id="product-list">Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
    <div class="pagination" id="pagination"></div>

    <script>
        let allProducts = [];
        let filteredProducts = [];
        const PAGE_SIZE = 50;
        let currentPage = 1;

        async function loadProductsJson() {
            const res = await fetch('./data/products.json');
            allProducts = await res.json();

            // ‚úÖ Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà Í∞úÏàò ÏßëÍ≥Ñ
            const categoryCounts = {};
            allProducts.forEach(p => {
                const cat = p.first_level_category_name || 'Î∂ÑÎ•ò ÏóÜÏùå';
                categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
            });

            // ‚úÖ ÏΩòÏÜî Ï∂úÎ†•
            console.log('üìä Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà Í∞úÏàò:');
            Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1]) // ÏàòÎüâ Í∏∞Ï§Ä ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
                .forEach(([cat, count]) => {
                    console.log(`- ${cat}: ${count}Í∞ú`);
                });

            const categorySet = new Set(allProducts.map(p => p.first_level_category_name).filter(Boolean));
            const select = document.getElementById('category-select');
            [...categorySet].sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });

            select.addEventListener('change', () => {
                currentPage = 1;
                renderFiltered();
            });

            renderFiltered();
        }

        function renderFiltered() {
            const selected = document.getElementById('category-select').value;

            // ÌïÑÌÑ∞ÎßÅ
            filteredProducts = selected === 'all'
                ? allProducts
                : allProducts.filter(p => p.first_level_category_name === selected);

            // ‚úÖ Ï†ïÎ†¨ (ÎπÑÏãº Í∞ÄÍ≤© Î®ºÏ†Ä)
            filteredProducts.sort((a, b) => {
                const priceA = parseFloat(a.target_sale_price || a.app_sale_price || 0);
                const priceB = parseFloat(b.target_sale_price || b.app_sale_price || 0);
                return priceB - priceA;
            });

            renderPage(currentPage);
            renderPagination();
        }

        function renderPage(page) {
            const container = document.getElementById('product-list');
            container.innerHTML = '';

            const start = (page - 1) * PAGE_SIZE;
            const end = start + PAGE_SIZE;
            const pageItems = filteredProducts.slice(start, end);

            pageItems.forEach(product => {
                const div = document.createElement('div');
                div.className = 'product';

                const img = document.createElement('img');
                img.src = product.product_small_image_urls?.string?.[0] || '';

                const info = document.createElement('div');
                const title = document.createElement('div');
                title.className = 'product-title';
                title.textContent = product.product_title || '(Ï†úÎ™© ÏóÜÏùå)';

                const keywords = document.createElement('div');
                keywords.className = 'keywords';
                keywords.textContent = `ÌÇ§ÏõåÎìú: ${product.keywords?.join(', ') || 'ÏóÜÏùå'}`;

                info.appendChild(title);
                info.appendChild(keywords);
                div.appendChild(img);
                div.appendChild(info);
                container.appendChild(div);
            });
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredProducts.length / PAGE_SIZE);
            const container = document.getElementById('pagination');
            container.innerHTML = '';

            const addButton = (label, page, disabled = false, isActive = false) => {
                const btn = document.createElement('button');
                btn.textContent = label;
                if (disabled) btn.disabled = true;
                if (isActive) btn.classList.add('active');
                btn.addEventListener('click', () => {
                    currentPage = page;
                    renderPage(currentPage);
                    renderPagination();
                });
                container.appendChild(btn);
            };

            addButton('¬´ Ïù¥Ï†Ñ', currentPage - 1, currentPage === 1);

            for (let i = 1; i <= totalPages; i++) {
                addButton(i, i, false, i === currentPage);
            }

            addButton('Îã§Ïùå ¬ª', currentPage + 1, currentPage === totalPages);
        }

        loadProductsJson();
    </script>
</body>

</html>